<!DOCTYPE html>
<h1>DESAFIO:</h1>
<ul>
	<li>
		1. Criar / rodar um docker com o PostgreSQL14
		<ul>
			<li>a. https://hub.docker.com/_/postgres</li>
		</ul>
	</li>
	<li>
		2. Utilizando Python 3.6+ e o microframework FLASK:
		<ul>
			<li>a. Crie uma API REST utilizando JSON para realizar um CRUD completo em uma tabela CLIENTE</li>
			<ul>
				<li>i. GET (Lista clientes)</li>
				<li>ii. POST (Criar cliente)</li>
				<li>iii. PUT (Editar cliente)</li>
				<li>iv. DELETE (Remover cliente)</li>
			</ul>
			<li>b. Dê preferência para o modelo de Blueprints do Flask.</li>
			<li>c. Se possível, utilizar algum ORM para conexão e manutenção das querys
				(Sugestão: SQL Alchemy)</li>
			<li>d. Criar Migrações para criação da tabela no banco com os campos:
				<ul>
					<li>i. código (primary_key / not null) </li>
					<li>ii. nome (not null)</li>
					<li>iii. razão social (not null)</li>
					<li>iv. cnpj (not null)</li>
					<li>v. data_inclusao (datetime / not null)</li>				
				</ul>
			</li>
			<li>e. Criar um Padrão de Respostas para API, com status_code e mensagens de sucesso ou erro, como por exemplo.
				<p>{</p>
				<p>&emsp;"status": 200,</p>	
				<p>&emsp;"message": "Cliente criado com sucesso"</p>
				<p>&emsp;"error": "null"</p>
				<p>}</p>					
			</li>
		</ul>
	</li>
</ul>
<h1>Como resolvi o desafio ^^</h1>
<h3>Após muita pesquisa (referencias no final)...</h3>
<h2>Passo a passo feito para incialização do docker com PostgreSQL 14.4</h2>
<h3>
	<ul>
		<li>1- instalar win docker</li>
		<li>2- instalar o kernel do linux wsl2 para pc x64</li>
		<li>3- abrir CMD</li>
	</ul>
</h3>
<h3>============= CRIAÇÃO DO DOCKER =============<h3>
<h4>
	<ul>
		<li>docker pull postgres</li>
		<li>docker run --name PostgresDocker -e POSTGRES_PASSWORD=root -d -p 5432:5432 postgres:14.4-alpine</li>
		<li>docker ps</li>
		<li>docker exec -it PostgresDocker bash</li>
		<li>ls</li>
		<li>psql</li>
		<li>psql -U postgres</li>
		<p>criando o banco desafio (por os ; pra n dar erro)</p>
		<li>create database desafio;</li>
		<li>\l</li>
		<p>agora podemos ver o banco ja criado</p>
		<p>conectar ao banco "desafio" como o usuario "postgres"</p>
		<li>\c desafio</li>
		<li>\d</li>
		
		<p>did not find any relations (ainda não possui nada no banco)</p>	
	</ul>
</h4>
<h3>============ FIM CRIAÇÃO DO DOCKER ============<h3>
<h3>============ Codigos docker para verificar DB ============</h3>
<h4>
	<ul>
		<p>executar imagem</p>
		<li>docker exec -it PostgresDocker(nomeImagem) bash</li>
		<li>pwd</li>
		<p>conectar no banco</p>
		<li>psql -U postgres(nomeusuario)</li>
		<p>listar base de dados</p>
		<li>\l</li>
		<li>create database nome / drop database nome</li>
		<p>conectar a base de dados</p>
		<li>\c desafio(nomedatabase)</li>
		<p>listar relacionamentos</p>
		<li>\d</li>
	</ul>
	<p>agora pode usar comandos SQL a vontade lembrando de usar ";" no final</p>
</h4>
<h3>==========================================================</h3>
<h3>======= testando conexão ao docker pelo SQL SHELL (psql) =======</h3>
<h3>
	<ul>
		<li>5- Pesquisa windows (SQL SHELL) e abrir o SQL SHELL (psql)</li>
		<p><h3>responder as perguntas de conexão:</h3></p>
		<h4>
			<ul>
				<li>Server: localhost</li>
				<li>Database: postgres</li>
				<li>Port: 5432</li>
				<li>Username: postgres</li>
				<li>Password: root</li>
				<p>psql(14.4)</p>
				<p>postgres=#</p>
			</ul>
		</h4>
	</ul>
</h3>
<h3>conseguimos conectar ao banco por fora do docker então está tudo ok testando outros comandos</h3>
	<ul>
		<h3>
		<li>\l</li>
		<li>\c desafio</li>
		</h3>
		<h4>you are now connected to database "desafio" as user "postgres".</h4>
		<h4>desafio=#</h4>
		<li><h3>\d</h3></li>
		<h4>mostrar relações</h4>
		<h4>did not find any relations</h4>
		<h4>conseguimos conectar ao nosso banco criado no docker de fora dele ja agora começar parte de Python</h4>
	</ul>
<h3>====================== Python ======================</h3>
<h3>
	<ul>
		<li>1 abrir terminal na pasta (no meu caso estou usando o ubuntu no windows)</li>
		<li>2 comandos para criar o enviroment</li>
	</ul>
</h3>
<h3>====================== VENV ======================</h3>
<h3>
	<ul>
		<li>python3 -m venv venv</li>
		<li>source venv/bin/activate</li>
		<li>pip install flask</li>
		<li>pip install flask_sqlalchemy</li>
		<li>pip install flask_migrate</li>
		<li>pip install psycopg2-binary</li>
	</ul>
</h3>
<h3>==================================================</h3>
<h3>code .</h3>
<h4>agora estamos com nosso ambiente criado e estamos no code para poder começar a criar a parte python</h4>
<h3><ul><li>3 apos setar as configs do banco e as migrações rodar o comando no terminal do code</li></ul></h3>
<h3>=============== Migration ==============</h3>
<h3>
	<ul>
		<li>python</li>
		<li>from app import *</li>
		<li>db_create_all()</li>
		<li>exit()</li>
	</ul>
</h3>
<h3>======================================</h3>
<h4>verificar se deu certo o codigo</h4>
<h3>
	<ul>
		<li>4 conectar a base de dados no docker (desafio) e executar (select * from cliente;) 
			sucesso, migrations foram subidas para o banco e a tabela ja possui codigo, nome, razaosocial, cnpj e data_inclusao</li>
		<h4>Toda info do por que utilizei cada coisa no programa está no código em si</h4>
			<li>5 para rodar o código (usei terminal ubuntu)  <--------- após ter feito a criação do docker</li>
	</ul>
</h3>
<h3>====================== RODAR CODIGO ======================</h3>
<h3>
	<ul>
		<li>CRIAR VENV PRIMEIRO</li>
		<li>source venv/bin/activate</li>
		<h3>==== executar isto na 1 vez para subir as tabelas ao banco ====</h3>
		<li>python</li>
		<li>from app import *</li>
		<li>db.create_all()</li>
		<li>exit()</li>
		<h3>================================================</h3>
		<li>flask run</li>
	</ul>
</h3>
<h2>agora está tudo rodando ^^</h2>
<h3>============================ Rotas ============================</h3>
<ul>
	<li>
		Criar novo Cliente:
		<ul>
			<li>POST http://127.0.0.1:5000/createCli</li>
			<li>body raw JSON</li>
			<li>
				<p>{</p>
				<p>&emsp;"nome":"novoNome",</p>
				<p>&emsp;"razao_social":"novaRazaoSocial",</p>
				<p>&emsp;"cnpj":"novoCNPJ" </p>
				<p>}</p> 
			</li>
			<li>o "codigo" e a "data_cadastro" é auto gerado pelo sistema</li>
		</ul>
	</li>
	<br>
	<li>
		Pegar lista de Clientes:
		<ul>
			<li>GET https://127.0.0.1:5000/listCli</li>
		</ul>
	</li>
	<br>
	<li>
		Atualizar Cliente:
		<ul>
			<li>PUT http://127.0.0.1:5000/updateCli</li>
			<li>body raw JSON</li>
			<li>
				<p>{</p>
				<p>&emsp;"codigo":"numCodigo",</p>
				<p>&emsp;"cnpj/nome/razao_social":"dado"</p>
				<p>}</p>
			</li>
			<li>pode ser atualizado 1 apenas ou os 3 ao mesmo tempo</li>
			<li>
				<p>{</p>
				<p>&emsp;"codigo":"8",</p>
				<p>&emsp;"cnpj":"12345678901258",</p>
				<p>&emsp;"nome":"Luis Guilherme",</p>
				<p>&emsp;"razao_social":"DrZebra"</p>
				<p>}</p>
			</li>
		</ul>
	</li>
	<br>
	<li>
		DELETE http://127.0.0.1:5000/deleteCli
		<ul>
			<li>
				<p>{</p>
				<p>&emsp;"codigo":"8"</p>
				<p>}</p>
			</li>
		</ul>
	</li>
</ul>
<h3>todas rotas estao tratadas para recusar envio sem JSON (exceto GET) JSON vazios ou com algum dado faltante</h3>
<h3>Todos os dados de nome e razão social estão em modo TITULO e são tratados para não possuir espaços duplos e nem começar ou terminar com espaço</h3>
<h3>===============================================================</h3>

<h2>Referencias:</h2>
<br>
<a href="https://hub.docker.com/_/postgres">https://hub.docker.com/_/postgres</a>
<br>
<a href="https://docs.sqlalchemy.org/en/14/core/constraints.html">https://docs.sqlalchemy.org/en/14/core/constraints.html</a>
<br>
<a href="https://docs.sqlalchemy.org/en/14/core/type_basics.html">https://docs.sqlalchemy.org/en/14/core/type_basics.html</a>
<br>
<a href="https://docs.sqlalchemy.org/en/14/orm/session_basics.html">https://docs.sqlalchemy.org/en/14/orm/session_basics.html</a>
<br>
<a href="https://www.w3schools.com/python/python_strings.asp">https://www.w3schools.com/python/python_strings.asp</a>
<br>
<a href="https://flask-sqlalchemy.palletsprojects.com/en/2.x/models/">https://flask-sqlalchemy.palletsprojects.com/en/2.x/models/</a>
<br>
<a href="https://blog.geekhunter.com.br/flask-framework-python/">https://blog.geekhunter.com.br/flask-framework-python/</a>
<br>
<a href="https://www.digitalocean.com/community/tutorials/processing-incoming-request-data-in-flask-pt">https://www.digitalocean.com/community/tutorials/processing-incoming-request-data-in-flask-pt</a>
<br>
<a href="https://www.hostinger.com.br/tutoriais/o-que-e-http-error-e-principais-codigos-http">https://www.hostinger.com.br/tutoriais/o-que-e-http-error-e-principais-codigos-http</a>
<br>
<a href="https://www.prisma.io/dataguide/postgresql/5-ways-to-host-postgresql">https://www.prisma.io/dataguide/postgresql/5-ways-to-host-postgresql</a>
<br>
<a href="https://stackoverflow.com/questions/23717834/importerror-no-module-named-psycopg2-after-install">https://stackoverflow.com/questions/23717834/importerror-no-module-named-psycopg2-after-install</a>
<br>
<a href="https://stackoverflow.com/questions/37099564/docker-how-can-run-the-psql-command-in-the-postgres-container">https://stackoverflow.com/questions/37099564/docker-how-can-run-the-psql-command-in-the-postgres-container</a>
<br>
<a href="https://stackoverflow.com/questions/57130278/how-can-i-check-postgres-database-in-docker-volume">https://stackoverflow.com/questions/57130278/how-can-i-check-postgres-database-in-docker-volume</a>
<br>
<a href="https://stackoverflow.com/questions/47656071/commanderror-cant-locate-revision-identified-by-when-migrating-using-fla">https://stackoverflow.com/questions/47656071/commanderror-cant-locate-revision-identified-by-when-migrating-using-fla</a>
<br>
<a href="https://stackoverflow.com/questions/5022066/how-to-serialize-sqlalchemy-result-to-json">https://stackoverflow.com/questions/5022066/how-to-serialize-sqlalchemy-result-to-json</a>
<br>
<a href="https://stackoverflow.com/questions/20808672/how-to-get-a-list-from-query-in-sqlalchemy">https://stackoverflow.com/questions/20808672/how-to-get-a-list-from-query-in-sqlalchemy</a>
<br>
<a href="https://stackoverflow.com/questions/7824101/return-http-status-code-201-in-flask">https://stackoverflow.com/questions/7824101/return-http-status-code-201-in-flask</a>
<br>
<a href="https://www.geeksforgeeks.org/python-convert-json-to-string/">https://www.geeksforgeeks.org/python-convert-json-to-string/</a>
<br>
<a href="https://www.youtube.com/watch?v=levz4eumJ98&ab_channel=PedroImpulcetto">https://www.youtube.com/watch?v=levz4eumJ98&ab_channel=PedroImpulcetto</a>
<br>
<a href="https://www.youtube.com/watch?v=uNmWxvvyBGU&ab_channel=PrettyPrinted">https://www.youtube.com/watch?v=uNmWxvvyBGU&ab_channel=PrettyPrinted</a>
<br>
<a href="https://www.youtube.com/watch?v=ca-Vj6kwK7M&ab_channel=Codemy.com">https://www.youtube.com/watch?v=ca-Vj6kwK7M&ab_channel=Codemy.com</a>
<br>
<a href="https://www.youtube.com/watch?v=Ad-inC3mJfU&ab_channel=k0nzebuilds">https://www.youtube.com/watch?v=Ad-inC3mJfU&ab_channel=k0nzebuilds</a>
<br>
<a href="https://www.youtube.com/watch?v=aHbE3pTyG-Q&ab_channel=Amigoscode">https://www.youtube.com/watch?v=aHbE3pTyG-Q&ab_channel=Amigoscode</a>
<br>
<a href="https://www.youtube.com/watch?v=Nm1FPcsPnWg&list=PLXmMXHVSvS-BlLA5beNJojJLlpE0PJgCW&index=29&ab_channel=PrettyPrinted">https://www.youtube.com/watch?v=Nm1FPcsPnWg&list=PLXmMXHVSvS-BlLA5beNJojJLlpE0PJgCW&index=29&ab_channel=PrettyPrinted</a>
<br>
<a href="https://www.youtube.com/watch?v=29OTNdCIrNU&list=PLXmMXHVSvS-BlLA5beNJojJLlpE0PJgCW&index=22&ab_channel=PrettyPrinted">https://www.youtube.com/watch?v=29OTNdCIrNU&list=PLXmMXHVSvS-BlLA5beNJojJLlpE0PJgCW&index=22&ab_channel=PrettyPrinted</a>
<br>
<a href="https://www.delftstack.com/pt/howto/python/python-check-if-character-is-number/#:~:text=na%20declara%C3%A7%C3%A3o%20condicional.-,Use%20o%20m%C3%A9todo%20isdigit()%20para%20verificar%20se%20um%20determinado,todos%20os%20caracteres%20forem%20d%C3%ADgitos.">https://www.delftstack.com/pt/howto/python/python-check-if-character-is-number/#:~:text=na%20declara%C3%A7%C3%A3o%20condicional.-,Use%20o%20m%C3%A9todo%20isdigit()%20para%20verificar%20se%20um%20determinado,todos%20os%20caracteres%20forem%20d%C3%ADgitos.</a>

